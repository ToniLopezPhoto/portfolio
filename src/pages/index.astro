---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import { dateRange } from "@lib/utils";
import { SITE, HOME, SOCIALS } from "@consts";

// --- IMÁGENES ---
import { Image } from "astro:assets";
// Importamos las fotos para el tendedero y el fallback
import foto1 from "../assets/foto1.jpg";
import foto2 from "../assets/foto2.jpg";
import foto3 from "../assets/foto3.jpg";
import foto4 from "../assets/foto4.jpg"; 
import foto5 from "../assets/foto5.jpg";
import foto6 from "../assets/foto6.jpg";
import foto7 from "../assets/foto7.jpg";
import foto8 from "../assets/foto8.jpg";

// --- CONFIGURACIÓN DE LA GALERÍA TENDEDERO ---
const datosGaleriaIniciales = [
  { img: foto1, titulo: "Memory Study No. 1" },
  { img: foto2, titulo: "Broken Bonds" },
  { img: foto3, titulo: "Waiting in the Jungle" },
  { img: foto5, titulo: "Portrait of Time" },
  { img: foto6, titulo: "The Warmth of Sound" },
  { img: foto7, titulo: "The Alchemist's Workshop" },
  { img: foto8, titulo: "Night Dialogue" }
];

// Desordenamos aleatoriamente
const galeriaTendedero = [...datosGaleriaIniciales].sort(() => Math.random() - 0.5);

function getRotacionAleatoria() {
  const angulos = [
    "rotate-1", "-rotate-1",
    "rotate-2", "-rotate-2",
    "rotate-3", "-rotate-3"
  ];
  return angulos[Math.floor(Math.random() * angulos.length)];
}

// --- DATOS ---

// 1. BLOG
const blog = (await getCollection("blog"))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0,SITE.NUM_POSTS_ON_HOMEPAGE);

// 2. PROYECTOS PARA LA GALERÍA MASONRY (SELECTED WORKS)
const masonryProjects = (await getCollection("projects"))
  .filter(project => !project.data.draft && project.data.featured === true)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// 3. WORK (Oculto pero cargado)
const allwork = (await getCollection("work"))
  .sort((a, b) => new Date(b.data.dateStart).valueOf() - new Date(a.data.dateStart).valueOf())
  .slice(0,SITE.NUM_WORKS_ON_HOMEPAGE);

const work = await Promise.all(
  allwork.map(async (item) => {
    const { Content } = await item.render();
    return { ...item, Content };
  })
);
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  
  <Container>
    <div class="space-y-12">
      <section>
        <article class="mt-2 space-y-6">
          <p class="animate text-3xl font-serif leading-relaxed text-white font-medium">
           Visual artist exploring 
            <span class="bg-white text-black px-0 py-0.5 rounded-sm">
             the civic jungle.
            </span> 
            I use photography to find meaning,
            <span class="bg-white text-black px-0 py-0.5 rounded-sm">
               human values
            </span>
            ,and the emotional ties that bind us.
          </p>

          <div class="animate flex gap-4">
            
            <a 
              href="/projects"
              class="group flex w-fit items-center gap-2 px-5 py-2.5 border border-white/20 text-white font-medium rounded-sm hover:bg-white/5 transition-all duration-300"
            >
              <span>View Works</span>
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform duration-300 group-hover:translate-x-1">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
              </svg>
            </a>
          </div>
        </article>
      </section>
    </div>
  </Container>

  <!-- SLIDER TENDEDERO CON LOOP INFINITO -->
  <div class="w-full overflow-hidden py-24 my-8 relative group-slider cursor-none" id="section-tendedero">
      
      <div id="drag-cursor" class="pointer-events-none fixed z-50 hidden md:flex items-center justify-center w-16 h-16 bg-white text-black text-[10px] font-bold uppercase tracking-widest rounded-full opacity-0 transition-opacity duration-200 transform -translate-x-1/2 -translate-y-1/2 mix-blend-difference">
        Drag
      </div>

      <div class="absolute top-[22%] left-0 w-full z-0 pointer-events-none opacity-60">
        <svg width="100%" height="40" viewBox="0 0 1200 40" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
           <path d="M0 20 C 300 25, 600 15, 900 20 C 1000 22, 1100 18, 1200 20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="text-white/40" vector-effect="non-scaling-stroke"/>
        </svg>
      </div>

      <div id="slider-tendedero" class="relative z-10 overflow-x-auto flex items-center scrollbar-hide px-4 md:px-8 select-none">
          <div id="slider-content" class="relative flex flex-nowrap items-start gap-12 min-w-max py-10 pointer-events-none">
              <!-- PRIMER SET DE IMÁGENES -->
              {galeriaTendedero.map((item) => {
                const rotacion = getRotacionAleatoria();
                return (
                <div class={`group relative bg-neutral-950 p-3 pb-5 rounded-sm shadow-lg border border-white/10 transition-transform duration-500 ease-out hover:scale-105 hover:rotate-0 ${rotacion} w-[280px] shrink-0 pointer-events-auto`}>
                   <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-4 h-6 bg-neutral-800 border border-white/20 rounded-sm z-20 shadow-sm"></div>
                   <div class="aspect-[4/3] overflow-hidden relative border border-white/5 bg-neutral-900">
                      <Image 
                        src={item.img}
                        alt={`Contact sheet: ${item.titulo}`}
                        class="object-cover w-full h-full grayscale group-hover:grayscale-0 transition-all duration-700 ease-out opacity-90 group-hover:opacity-100 pointer-events-none"
                        width={400} 
                        format="webp"
                      />
                   </div>
                   <p class="font-handwriting text-left text-white/70 mt-4 text-base tracking-wide transition-colors group-hover:text-white">
                       {item.titulo}
                   </p>
                </div>
              )})}
              <!-- SEGUNDO SET DE IMÁGENES (DUPLICADO PARA LOOP) -->
              {galeriaTendedero.map((item) => {
                const rotacion = getRotacionAleatoria();
                return (
                <div class={`group relative bg-neutral-950 p-3 pb-5 rounded-sm shadow-lg border border-white/10 transition-transform duration-500 ease-out hover:scale-105 hover:rotate-0 ${rotacion} w-[280px] shrink-0 pointer-events-auto`}>
                   <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-4 h-6 bg-neutral-800 border border-white/20 rounded-sm z-20 shadow-sm"></div>
                   <div class="aspect-[4/3] overflow-hidden relative border border-white/5 bg-neutral-900">
                      <Image 
                        src={item.img}
                        alt={`Contact sheet: ${item.titulo}`}
                        class="object-cover w-full h-full grayscale group-hover:grayscale-0 transition-all duration-700 ease-out opacity-90 group-hover:opacity-100 pointer-events-none"
                        width={400} 
                        format="webp"
                      />
                   </div>
                   <p class="font-handwriting text-left text-white/70 mt-4 text-base tracking-wide transition-colors group-hover:text-white">
                       {item.titulo}
                   </p>
                </div>
              )})}
              <div class="w-8 shrink-0"></div>
          </div>
      </div>
  </div>

  <!-- NUEVA SECCIÓN DESPUÉS DEL SLIDER -->
  <Container>
    <div class="space-y-24 ">
    

    

      <section class="animate grid grid-cols-1 md:grid-cols-2 gap-12 items-start">
        <div class="space-y-6">
          <h5 class="font-serif text-3xl text-white font-medium leading-tight">
            The desire to change something, without finding it. 
            <span class="bg-white text-black px-2 py-0.5 rounded-sm decoration-clone">
            The desire to be, without being.
            </span>
          </h5>
          <p class="text-gray-300 leading-relaxed">
            Each image is a fragment of a silent conversation. In my creative process, I seek to deconstruct the everyday to find the hidden poetry in urban and human structures.
          </p>
        </div>
        
        <div class="aspect-square overflow-hidden rounded-sm bg-neutral-900 relative group border border-white/10">
           <Image 
             src={foto4} 
             alt="About me"
             class="object-cover w-full h-full grayscale group-hover:grayscale-0 transition-all duration-700 ease-out group-hover:scale-105"
             width={600} 
             format="webp"
           />
        </div>
      </section>

      <div class="animate border-t border-white/20"></div>

      <section class="animate space-y-8">
        <div class="flex items-end justify-between">
            <h5 class="font-serif text-3xl text-white font-medium">Selected Works</h5>
            <a 
              href="/projects"
              class="group flex items-center gap-2 text-white/70 hover:text-white transition-colors duration-300"
            >
              <span>View all</span>
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform duration-300 group-hover:translate-x-1">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
              </svg>
            </a>
        </div>

        <div class="columns-1 md:columns-2 gap-4 space-y-4">
            {masonryProjects.map((project) => (
                <a href={`/projects/${project.slug}`} class="break-inside-avoid relative group overflow-hidden rounded-sm block bg-neutral-900 border border-white/5">
                    <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all duration-500 z-20 flex flex-col items-center justify-center p-4 text-center">
                        <span class="text-white font-serif text-2xl italic border-b border-white/50 pb-2 mb-2 translate-y-4 group-hover:translate-y-0 transition-transform duration-500">
                            {project.data.title}
                        </span>
                        <span class="text-white/60 text-sm font-sans uppercase tracking-widest translate-y-4 group-hover:translate-y-0 transition-transform duration-700 delay-75">
                            View Project
                        </span>
                    </div>
                    <Image 
                        src={project.data.heroImage || foto1} 
                        alt={project.data.title}
                        class="w-full h-auto object-cover grayscale group-hover:grayscale-0 transition-all duration-1000 ease-in-out group-hover:scale-105"
                        width={1000} 
                        format="webp"
                    />
                </a>
            ))}
        </div>
      </section>

      <div class="animate border-t border-white/20"></div>

      <!-- SECCIÓN REESTRUCTURADA -->
      <section class="animate space-y-6">
        <h5 class="font-serif text-3xl text-white font-medium">
          A continuous journey of 
          <span class="bg-white text-black px-2 py-0.5 rounded-sm decoration-clone">
            death and rebirth
          </span>
        </h5>
        
        <article class="max-w-4xl space-y-4">
          <p class="text-gray-300 leading-relaxed text-lg">
            Since I discovered photography, everything has been a sea of doubts and ignorance. For this reason, I enjoy taking my photographs so much—they are a process of constant transformation in search of self-knowledge and exploration of the vast world that surrounds us.
          </p>
          
          <p class="text-gray-300 leading-relaxed text-lg">
            For years I have been interested in topics such as pain as a transforming agent, emotional ties, and the passage of time. My influences and references are fed by contemporary music and literature, in addition to painting, sculpture and architecture from the beginning of the 20th century until today, without forgetting our greats of the Renaissance, Baroque or Romanticism.
          </p>
        </article>
      </section>

      <div class="animate border-t border-white/20"></div>

      <section class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <h5 class="font-serif text-2xl text-white font-medium">Latest posts</h5>
          <a 
            href="/blog"
            class="group flex items-center gap-2 text-white/70 hover:text-white transition-colors duration-300"
          >
            <span>See all posts</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform duration-300 group-hover:translate-x-1">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>
        <ul class="flex flex-col gap-4">
          {blog.map(post => (
            <li>
              <ArrowCard entry={post} />
            </li>
          ))}
        </ul>
      </section>

      <div class="animate border-t border-white/20"></div>

      <section class="animate space-y-4">
        <h5 class="font-serif text-2xl text-white font-medium">Let's Connect</h5>
        <article>
          <p class="text-gray-300">
            If you want to get in touch with me about something or just to say hi,
            reach out via email or use the contact form.
          </p>
        </article>
        <div class="animate">
          <a 
            href="/contact"
            class="group flex w-fit items-center gap-2 px-5 py-2.5 border border-white/20 text-white font-medium rounded-sm hover:bg-white/5 transition-all duration-300"
          >
            <span>Contact me</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>
      </section>
    </div>
  </Container>

  <style>
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>

 <script is:inline>
    function initSlider() {
      const slider = document.getElementById('slider-tendedero');
      const sectionTendedero = document.getElementById('section-tendedero');
      const dragCursor = document.getElementById('drag-cursor');
      const sliderContent = document.getElementById('slider-content');

      if (!slider || !sectionTendedero || !dragCursor || !sliderContent) return;

      // === LÓGICA DEL LOOP INFINITO ===
      let scrollWidth = sliderContent.scrollWidth / 2; // Mitad porque duplicamos
      
      const checkScroll = () => {
        if (slider.scrollLeft >= scrollWidth) {
          slider.scrollLeft = 0;
        } else if (slider.scrollLeft <= 0) {
          slider.scrollLeft = scrollWidth;
        }
      };

      slider.addEventListener('scroll', checkScroll);

      // === LÓGICA DEL SLIDER DRAG ===
      let isDown = false;
      let startX;
      let scrollLeft;

      const onMouseDown = (e) => {
        isDown = true;
        slider.classList.add('active'); 
        startX = e.pageX - slider.offsetLeft;
        scrollLeft = slider.scrollLeft;
      };

      const onMouseLeave = () => {
        isDown = false;
        slider.classList.remove('active');
        dragCursor.classList.add('opacity-0');
      };

      const onMouseUp = () => {
        isDown = false;
        slider.classList.remove('active');
      };

      const onMouseMove = (e) => {
        if(!isDown) return;
        e.preventDefault();
        const x = e.pageX - slider.offsetLeft;
        const walk = (x - startX) * 2;
        slider.scrollLeft = scrollLeft - walk;
      };

      slider.addEventListener('mousedown', onMouseDown);
      slider.addEventListener('mouseleave', onMouseLeave);
      slider.addEventListener('mouseup', onMouseUp);
      slider.addEventListener('mousemove', onMouseMove);

      // === LÓGICA DEL CURSOR "DRAG" ===
      const onSectionMove = (e) => {
          dragCursor.style.left = e.clientX + 'px';
          dragCursor.style.top = e.clientY + 'px';
      };

      const onSectionEnter = () => {
          dragCursor.classList.remove('opacity-0');
      };

      const onSectionLeave = () => {
          dragCursor.classList.add('opacity-0');
      };

      sectionTendedero.addEventListener('mousemove', onSectionMove);
      sectionTendedero.addEventListener('mouseenter', onSectionEnter);
      sectionTendedero.addEventListener('mouseleave', onSectionLeave);
    }

    initSlider();
    document.addEventListener('astro:page-load', initSlider);
  </script>

</PageLayout>